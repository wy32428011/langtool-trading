# LangTool Trading - 股票智能分析与交易建议系统

这是一个基于大语言模型（LLM）的自动化股票数据分析系统。它结合了传统的技术指标分析与现代的 AI 逻辑推理，旨在为交易员提供深度的市场洞察和 T+1 交易建议。

## 🌟 核心功能

- **自动化分析**：自动获取股票基本面背景、实时行情以及历史走势。
- **技术指标集成**：自动计算 MA（均线）、RSI（强弱指标）、MACD（趋势指标）、KDJ（超买超卖）以及布林带等核心技术指标。
- **智能因子 (Alpha158)**：整合基于量价多因子模型计算的 Alpha158 因子，提供量化层面的参考。
- **思考与自我辩驳 (Thinking & Self-Rebuttal)**：模型在输出结论前必须进行深度思考，并主动寻找反向证据（自我辩驳），以确保分析结果的理性和精确。
- **LLM 逻辑推理**：利用 DeepSeek 或 Qwen 等大模型扮演资深分析师，对技术面和量化因子进行共振分析。
- **多模式支持**：
    - **单股模式**：针对特定股票代码进行深度复盘。
    - **批量模式**：支持多线程并发分析，快速扫描全市场机会。
    - **多角色流程模式 (LangGraph)**：基于 LangGraph 构建的多角色协同工作流，模拟基本面分析师、技术分析师和资深交易员的评审过程，提供更全面的分析视角。
    - **2560 战法模式**：专门针对 A 股 2560 战法（25 日与 60 日均线结合）设计的分析模式。
    - **实时分析模式**：实时循环抓取最新数据并进行大模型动态分析，每 10 秒更新一次分析结论。
- **报表产出**：分析结果自动保存为 Excel 格式，方便查阅和归档。

## 🛠️ 技术栈

- **核心框架**: LangChain, LangGraph
- **大模型支持**: DeepSeek, OpenAI 兼容接口 (如通义千问, SiliconFlow)
- **数据处理**: Pandas, SQLAlchemy
- **数据库**: MySQL
- **包管理**: uv

## 🚀 快速开始

### 1. 环境准备

确保你的系统已安装 Python 3.13 或以上版本。推荐使用 [uv](https://github.com/astral-sh/uv) 进行包管理。

```bash
# 安装依赖
uv pip install -r pyproject.toml
```

### 2. 配置说明

项目根目录下需要配置相关环境变量（或直接修改 `config.py`）：

- **数据库配置**：在 `config.py` 中修改 `Settings` 类下的数据库连接信息。
- **LLM 配置**：
    - `llm_type`: 可选 `qwen`, `deepseek`, `siliconflow`。
    - `llm_api_key`: 填入对应平台的 API Key。
    - `llm_base_url`: 填入对应平台的接口地址。

### 3. 使用方式

通过 `main.py` 运行程序：

#### 单只股票分析
```bash
python main.py --code 601096
```

#### 全量股票批量分析
```bash
python main.py --batch --workers 80
```
*参数 `--workers` 可指定并发线程数，默认 80。*

#### 多角色流程分析 (LangGraph)
```bash
python analysisflow.py --code 601096
```
*该模式将启动多智能体协作流，分别由基本面分析师和技术分析师进行研判，最后由交易员给出整合建议。*

#### 2560 战法分析
```bash
# 单只股票分析
python analysis2560.py --code 601096

# 全量股票批量分析
python batch2560.py --workers 80
```
*该模式专注于 2560 战法逻辑，结合 25 日和 60 日均线趋势进行专项分析。*

#### 实时分析
```bash
python realtime_analysis.py
```
*运行后可输入股票代码或直接在命令行跟上代码（如 `python realtime_analysis.py 000001`）。程序将进入持续监控状态，每 10 秒刷新一次分析结果，按 `Ctrl+C` 退出。*

## 📂 项目结构

- `main.py`: 程序入口，负责命令行参数解析。
- `analysis.py`: 核心业务逻辑，负责数据聚合、指标计算及分析流程控制。
- `analysisflow.py`: 基于 LangGraph 的多角色协同分析流。
- `analysis2560.py`: A 股 2560 战法专项分析工具。
- `batch2560.py`: A 股 2560 战法批量分析工具。
- `realtime_analysis.py`: 股票实时监控与动态分析工具。
- `agent.py`: 封装 LLM 交互逻辑，定义系统提示词。
- `database.py`: 数据库操作层，负责历史数据查询及因子获取。
- `config.py`: 项目配置文件。
- `engine.py`: 数据库引擎配置。
- `output/`: 自动生成的分析报表存放目录。

## 📊 输出结果说明

系统生成的 Excel 报告包含以下字段：
- **股票信息**: 代码、名称、当前价格。
- **分析结论**: 趋势判断、详细逻辑、信心值。
- **交易建议**: 包含建议买入价格、建议卖出价格。
- **交易指令**: 包含具体的触发条件、仓位建议以及操作动作。
- **风险提示**: 针对该股的潜在风险。

## ⚠️ 免责声明

本系统提供的所有分析结果及交易建议均基于历史数据及模型推断，**仅供参考，不构成任何投资建议**。股市有风险，入市需谨慎。用户基于本系统做出的任何投资决策，风险自担。

---
*本项目由 LangChain 强力驱动。*
